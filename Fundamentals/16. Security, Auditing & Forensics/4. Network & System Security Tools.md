***
**Network & System Security Tools:** `iptables`, `firewalld`, `ufw`, `fail2ban`, `tcpdump`, `nmap`
***
***
# Iptables Command in Linux

## Overview

`iptables` is a user-space utility program that allows a system administrator to configure the IP packet filter rules of the Linux kernel firewall. It is used for packet filtering, network address translation (NAT), and port forwarding.

## Basic Syntax

```
iptables [-t table] command [chain] [criteria] [action]
```

- `-t table` : Specifies the table to use. Default is `filter`.
    
- `command` : The action to perform (e.g., `-A`, `-D`, `-I`).
    
- `chain` : The chain to operate on (`INPUT`, `OUTPUT`, `FORWARD`, `PREROUTING`, `POSTROUTING`).
    
- `criteria` : Conditions for matching packets (source, destination, protocol, port).
    
- `action` : Action to perform on matched packets (`ACCEPT`, `DROP`, `REJECT`).
    

## Tables

- `filter` : Default table for packet filtering.
    
- `nat` : For network address translation.
    
- `mangle` : For specialized packet alteration.
    
- `raw` : For exemption from connection tracking.
    
- `security` : For SELinux or security modules.
    

## Commands / Options

### Chain Operations

- `-A` or `--append` : Append a rule to the end of the chain.
    
    ```
    iptables -A INPUT -p tcp --dport 22 -j ACCEPT
    ```
    
- `-I` or `--insert` : Insert a rule at a specific position.
    
    ```
    iptables -I INPUT 1 -p tcp --dport 80 -j ACCEPT
    ```
    
- `-D` or `--delete` : Delete a rule by specification or number.
    
    ```
    iptables -D INPUT -p tcp --dport 22 -j ACCEPT
    iptables -D INPUT 1
    ```
    
- `-R` or `--replace` : Replace a rule at a specific position.
    
    ```
    iptables -R INPUT 2 -p tcp --dport 443 -j ACCEPT
    ```
    
- `-L` or `--list` : List rules in a chain.
    
    ```
    iptables -L
    iptables -L -v -n
    ```
    
- `-F` or `--flush` : Flush all rules in a chain.
    
    ```
    iptables -F INPUT
    ```
    
- `-Z` or `--zero` : Zero packet and byte counters.
    
    ```
    iptables -Z
    ```
    
- `-N` or `--new-chain` : Create a new user-defined chain.
    
    ```
    iptables -N MYCHAIN
    ```
    
- `-X` or `--delete-chain` : Delete a user-defined chain.
    
    ```
    iptables -X MYCHAIN
    ```
    

### Packet Matching Options

- `-p` or `--protocol` : Protocol (tcp, udp, icmp).
    
    ```
    iptables -A INPUT -p tcp -j ACCEPT
    ```
    
- `-s` or `--source` : Source IP address or subnet.
    
    ```
    iptables -A INPUT -s 192.168.1.0/24 -j ACCEPT
    ```
    
- `-d` or `--destination` : Destination IP address or subnet.
    
    ```
    iptables -A OUTPUT -d 10.0.0.5 -j DROP
    ```
    
- `--sport` : Source port.
    
    ```
    iptables -A INPUT -p tcp --sport 22 -j ACCEPT
    ```
    
- `--dport` : Destination port.
    
    ```
    iptables -A INPUT -p tcp --dport 80 -j ACCEPT
    ```
    
- `-i` or `--in-interface` : Incoming network interface.
    
    ```
    iptables -A INPUT -i eth0 -j ACCEPT
    ```
    
- `-o` or `--out-interface` : Outgoing network interface.
    
    ```
    iptables -A OUTPUT -o eth1 -j ACCEPT
    ```
    
- `-m` or `--match` : Use an extension match module.
    
    ```
    iptables -A INPUT -p tcp -m state --state ESTABLISHED,RELATED -j ACCEPT
    ```
    

### Actions / Targets

- `ACCEPT` : Accept the packet.
    
- `DROP` : Drop the packet silently.
    
- `REJECT` : Reject the packet with an error.
    
- `LOG` : Log the packet.
    
    ```
    iptables -A INPUT -p tcp --dport 22 -j LOG --log-prefix "SSH attempt: "
    ```
    
- `SNAT` : Source NAT (for `nat` table).
    
- `DNAT` : Destination NAT (for `nat` table).
    
- `MASQUERADE` : Dynamic NAT (for `nat` table).
    

### Saving and Restoring Rules

- Save current rules:
    
    ```
    iptables-save > /etc/iptables/rules.v4
    ```
    
- Restore rules:
    
    ```
    iptables-restore < /etc/iptables/rules.v4
    ```
    

### Examples

1.  Allow incoming SSH:

```
iptables -A INPUT -p tcp --dport 22 -j ACCEPT
```

2.  Block an IP address:

```
iptables -A INPUT -s 203.0.113.10 -j DROP
```

3.  Allow HTTP and HTTPS:

```
iptables -A INPUT -p tcp --dport 80 -j ACCEPT
iptables -A INPUT -p tcp --dport 443 -j ACCEPT
```

4.  Allow established connections only:

```
iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
```

5.  NAT for outgoing traffic (masquerade):

```
iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
```

## Useful Tips

- Use `iptables -L -v -n` for a detailed view with packet counts.
    
- Order of rules matters; the first match applies.
    
- Always save rules after making changes.
    
- Use `iptables -S` to see rules in command format.
    

This guide provides a complete overview of `iptables` commands, options, tables, chains, and examples for practical usage.

* * *

* * *

# Firewalld Command in Linux

## Overview

`firewalld` is a dynamic firewall management tool in Linux that provides a way to manage firewall rules with support for network zones, rich language rules, and runtime configuration. It acts as a front-end for `iptables` and `nftables` and supports both IPv4 and IPv6.

## Basic Syntax

```
firewall-cmd [options]
```

- `--state` : Show the state of firewalld (running or not).
    
- `--reload` : Reload firewall rules without restarting the service.
    
- `--list-all` : Display all rules and settings.
    
- `--zone=zone` : Specify the zone to operate on.
    
- `--permanent` : Apply changes permanently.
    

## Zones

Firewalld uses zones to define the level of trust for network connections.

- `public` : Default for unknown networks.
    
- `home` : For trusted home networks.
    
- `work` : For work networks.
    
- `internal` : For internal networks.
    
- `external` : For external networks with masquerading.
    
- `dmz` : For demilitarized zones.
    
- `trusted` : All traffic allowed.
    
- `block` : Block all incoming connections.
    
- `drop` : Drop all incoming packets silently.
    

### List Available Zones

```
firewall-cmd --get-zones
```

### Get Default Zone

```
firewall-cmd --get-default-zone
```

## Basic Commands

### Check Firewalld Status

```
systemctl status firewalld
firewall-cmd --state
```

### Start, Stop, Enable, Disable

```
systemctl start firewalld
systemctl stop firewalld
systemctl enable firewalld
systemctl disable firewalld
```

### Adding and Removing Services

```
firewall-cmd --zone=public --add-service=http
firewall-cmd --zone=public --remove-service=http
firewall-cmd --zone=public --add-service=http --permanent
firewall-cmd --reload
```

### Adding and Removing Ports

```
firewall-cmd --zone=public --add-port=8080/tcp
firewall-cmd --zone=public --remove-port=8080/tcp
firewall-cmd --zone=public --add-port=8080/tcp --permanent
firewall-cmd --reload
```

### Adding and Removing Rich Rules

```
firewall-cmd --zone=public --add-rich-rule='rule family=ipv4 source address=192.168.1.100 port port=22 protocol=tcp accept'
firewall-cmd --zone=public --remove-rich-rule='rule family=ipv4 source address=192.168.1.100 port port=22 protocol=tcp accept'
firewall-cmd --reload
```

### Masquerading / NAT

```
firewall-cmd --zone=external --add-masquerade
firewall-cmd --zone=external --remove-masquerade
firewall-cmd --permanent --zone=external --add-masquerade
firewall-cmd --reload
```

### Forwarding

```
firewall-cmd --zone=internal --add-forward-port=port=80:proto=tcp:toport=8080:toaddr=192.168.1.50
firewall-cmd --reload
```

### Listing Rules and Settings

```
firewall-cmd --list-all
firewall-cmd --zone=public --list-all
firewall-cmd --list-services
firewall-cmd --list-ports
firewall-cmd --list-rich-rules
```

### Runtime vs Permanent

- Runtime changes are immediate but lost on reboot.
    
- Permanent changes persist across reboots.
    
- Apply permanent changes by adding `--permanent` and reload firewall after.
    

### Example Use Cases

1.  Allow SSH in the public zone:

```
firewall-cmd --zone=public --add-service=ssh --permanent
firewall-cmd --reload
```

2.  Open TCP port 8080:

```
firewall-cmd --zone=public --add-port=8080/tcp --permanent
firewall-cmd --reload
```

3.  Enable masquerading for external zone:

```
firewall-cmd --zone=external --add-masquerade --permanent
firewall-cmd --reload
```

4.  Forward HTTP traffic from port 80 to 8080 on a specific host:

```
firewall-cmd --zone=internal --add-forward-port=port=80:proto=tcp:toport=8080:toaddr=192.168.1.50 --permanent
firewall-cmd --reload
```

5.  Add a rich rule to accept traffic from a specific IP:

```
firewall-cmd --zone=public --add-rich-rule='rule family=ipv4 source address=192.168.1.100 accept' --permanent
firewall-cmd --reload
```

## Useful Tips

- Use `firewall-cmd --list-all-zones` to see all zones with their rules.
    
- Always reload after making permanent changes.
    
- Use `firewall-cmd --get-active-zones` to check which zones are currently applied to interfaces.
    
- Runtime changes can be tested before making them permanent.
    

This guide provides a comprehensive overview of the `firewalld` command in Linux, including zones, services, ports, rich rules, NAT, forwarding, and practical examples.

* * *

* * *

# UFW Command in Linux

## Overview

`ufw` (Uncomplicated Firewall) is a user-friendly front-end for managing firewall rules in Linux. It provides an easy way to manage `iptables` rules for host-based firewalls.

## Basic Syntax

```
ufw [options] [rule]
```

- Options control behavior and rule application.
    
- Rules define what traffic is allowed or denied.
    

## Basic Commands

### Enable / Disable / Status

```
ufw enable
ufw disable
ufw status
ufw status verbose
```

### Allow / Deny / Reject

```
ufw allow 22
ufw allow 80/tcp
ufw deny 23
ufw reject 25/tcp
```

- `allow` : Permit the traffic.
    
- `deny` : Block the traffic silently.
    
- `reject` : Block the traffic and send an error response.
    

### Limit Connections

```
ufw limit ssh/tcp
```

- Protects against brute-force attacks by limiting connection attempts.

### Remove Rules

```
ufw delete allow 22
ufw delete deny 23
```

### Application Profiles

```
ufw app list
ufw app info OpenSSH
ufw allow OpenSSH
```

- Allows managing predefined application rules.

### Logging

```
ufw logging on
ufw logging off
ufw logging high
ufw logging medium
ufw logging low
ufw logging full
```

- Controls firewall logging level.

### Default Policies

```
ufw default allow outgoing
ufw default deny incoming
ufw default deny routed
```

- Set default policies for incoming, outgoing, and routed traffic.

### Advanced Options

- Limit per IP

```
ufw limit ssh/tcp
```

- Specify source or destination

```
ufw allow from 192.168.1.10
ufw allow from 192.168.1.0/24 to any port 80 proto tcp
```

- Allow traffic to a specific interface

```
ufw allow in on eth0 to any port 22
ufw allow out on eth1 from any port 1024:65535
```

### IPv6 Support

- Enable IPv6 in `/etc/default/ufw`
    
- Use `ufw` commands normally; IPv6 is handled automatically.
    

## Examples

1.  Allow SSH

```
ufw allow ssh
ufw enable
```

2.  Allow HTTP and HTTPS

```
ufw allow 80/tcp
ufw allow 443/tcp
```

3.  Deny Telnet

```
ufw deny 23
```

4.  Limit SSH connections to prevent brute-force

```
ufw limit ssh/tcp
```

5.  Allow from specific IP

```
ufw allow from 192.168.1.50 to any port 22
```

6.  Allow specific subnet to access HTTP

```
ufw allow from 192.168.1.0/24 to any port 80 proto tcp
```

7.  Delete a rule

```
ufw delete allow 22
```

8.  Set default policies

```
ufw default deny incoming
ufw default allow outgoing
```

## Useful Tips

- Always check `ufw status verbose` to verify rules.
    
- Use `ufw reset` to remove all rules and start fresh.
    
- Combine `ufw` with `iptables` for advanced scenarios.
    
- Use `ufw app list` for applications that have predefined profiles.
    

This guide provides a comprehensive overview of the `ufw` command in Linux, including enabling, disabling, allowing, denying, limiting, logging, default policies, advanced rules, and practical examples.

* * *

* * *

# Fail2Ban Command in Linux

## Overview

`Fail2Ban` is an intrusion prevention software framework that protects servers from brute-force attacks. It monitors log files for suspicious activity and bans IP addresses that show malicious behavior using firewall rules.

## Installation

```
sudo apt install fail2ban       # Debian/Ubuntu
sudo yum install fail2ban       # CentOS/RHEL
sudo dnf install fail2ban       # Fedora
```

## Basic Configuration Files

- `/etc/fail2ban/jail.conf` : Default configuration.
    
- `/etc/fail2ban/jail.local` : User-defined overrides to prevent updates from overwriting.
    
- `/etc/fail2ban/filter.d/` : Directory for filter definitions.
    

## Basic Syntax

```
fail2ban-client [options] <command> [parameters]
```

## Common Commands

### Check Status

```
fail2ban-client status
fail2ban-client status <jail_name>
```

- Shows the status of fail2ban service and specific jails.

### Start, Stop, Restart

```
systemctl start fail2ban
systemctl stop fail2ban
systemctl restart fail2ban
systemctl enable fail2ban
systemctl disable fail2ban
```

### Manage Jails

- Enable a jail

```
fail2ban-client start <jail_name>
```

- Disable a jail

```
fail2ban-client stop <jail_name>
```

### Ban and Unban IP Addresses

- Ban an IP manually

```
fail2ban-client set <jail_name> banip 192.168.1.100
```

- Unban an IP

```
fail2ban-client set <jail_name> unbanip 192.168.1.100
```

### Reload Configuration

```
fail2ban-client reload
```

## Jails

- Jails define rules for monitoring specific services.
    
- Each jail contains settings like enabled, port, filter, logpath, maxretry, bantime.
    

### Example: SSH Jail

```
[sshd]
enabled = true
port = ssh
filter = sshd
logpath = /var/log/auth.log
maxretry = 5
bantime = 600
```

- `enabled` : Activate the jail.
    
- `port` : Port number to monitor.
    
- `filter` : Name of the filter file in `/etc/fail2ban/filter.d/`.
    
- `logpath` : Path to the log file.
    
- `maxretry` : Number of failed attempts before banning.
    
- `bantime` : Duration of the ban in seconds.
    

## Filters

- Filters define regex patterns to detect failed login attempts.
    
- Stored in `/etc/fail2ban/filter.d/`.
    

### Example Filter for SSH

```
[Definition]
failregex = ^%(__prefix_line)sFailed password for .* from <HOST> port.*$
ignoreregex =
```

- `<HOST>` : Matches the IP address to ban.
    
- `failregex` : Regex pattern for detecting failures.
    
- `ignoreregex` : Regex for ignoring patterns.
    

## Example Commands

1.  Check status of all jails

```
fail2ban-client status
```

2.  Check status of sshd jail

```
fail2ban-client status sshd
```

3.  Ban an IP manually

```
fail2ban-client set sshd banip 192.168.1.100
```

4.  Unban an IP

```
fail2ban-client set sshd unbanip 192.168.1.100
```

5.  Start sshd jail

```
fail2ban-client start sshd
```

6.  Stop sshd jail

```
fail2ban-client stop sshd
```

7.  Reload fail2ban configuration

```
fail2ban-client reload
```

## Useful Tips

- Always use `jail.local` to customize jails instead of modifying `jail.conf`.
    
- Use `fail2ban-client status <jail_name>` to monitor currently banned IPs.
    
- Combine with `iptables` or `firewalld` for firewall enforcement.
    
- Log files are crucial; ensure correct `logpath` in jails.
    
- Regularly update filters to accommodate new attack patterns.
    

This guide provides a comprehensive overview of the `fail2ban` command in Linux, including installation, configuration, jails, filters, commands, and practical examples.

* * *

* * *

# Tcpdump Command in Linux

## Overview

`tcpdump` is a powerful command-line packet analyzer tool in Linux used for network monitoring and troubleshooting. It captures network packets and displays them in detail for analysis.

## Basic Syntax

```
tcpdump [options] [expression]
```

- `options` : Flags and parameters to control output, capture, and behavior.
    
- `expression` : Defines the filter for capturing specific packets (host, port, protocol, etc.).
    

## Common Options

### General Options

- `-i <interface>` : Specify network interface to capture from.
    
    ```
    tcpdump -i eth0
    ```
    
- `-nn` : Do not resolve hostnames or port names.
    
    ```
    tcpdump -nn -i eth0
    ```
    
- `-v`, `-vv`, `-vvv` : Increase verbosity.
    
    ```
    tcpdump -vv -i eth0
    ```
    
- `-c <count>` : Capture only a specific number of packets.
    
    ```
    tcpdump -c 10 -i eth0
    ```
    
- `-w <file>` : Write captured packets to a file.
    
    ```
    tcpdump -i eth0 -w capture.pcap
    ```
    
- `-r <file>` : Read packets from a file.
    
    ```
    tcpdump -r capture.pcap
    ```
    
- `-s <snaplen>` : Capture the first bytes of each packet. Default is 262144.
    
    ```
    tcpdump -s 0 -i eth0
    ```
    
- `-t` : Do not print timestamp.
    
- `-tttt` : Print full timestamp.
    
- `-X` : Show packet contents in hex and ASCII.
    
- `-A` : Show packet contents in ASCII only.
    

### Capture Filters

- `host <IP>` : Capture packets from/to specific host.
    
    ```
    tcpdump -i eth0 host 192.168.1.10
    ```
    
- `src <IP>` : Capture packets from source IP.
    
- `dst <IP>` : Capture packets to destination IP.
    
- `net <network>` : Capture packets from specific network.
    
- `port <port>` : Capture packets with specific port.
    
    ```
    tcpdump -i eth0 port 80
    ```
    
- `src port <port>` : Capture packets from source port.
    
- `dst port <port>` : Capture packets to destination port.
    
- `tcp`, `udp`, `icmp` : Capture only specific protocol packets.
    
    ```
    tcpdump -i eth0 tcp
    ```
    
- `and`, `or`, `not` : Combine filters.
    
    ```
    tcpdump -i eth0 tcp and port 22
    ```
    

### Display Options

- `-e` : Display link-layer header.
    
- `-q` : Quick (less verbose) output.
    
- `-S` : Print absolute TCP sequence numbers.
    

### Examples

1.  Capture packets on interface eth0

```
tcpdump -i eth0
```

2.  Capture 10 packets

```
tcpdump -c 10 -i eth0
```

3.  Capture packets from host 192.168.1.100

```
tcpdump -i eth0 host 192.168.1.100
```

4.  Capture TCP traffic on port 22

```
tcpdump -i eth0 tcp port 22
```

5.  Capture packets and save to file

```
tcpdump -i eth0 -w capture.pcap
```

6.  Read packets from file

```
tcpdump -r capture.pcap
```

7.  Capture HTTP traffic and display contents in ASCII

```
tcpdump -i eth0 port 80 -A
```

8.  Capture all ICMP packets

```
tcpdump -i eth0 icmp
```

9.  Capture packets from source IP and destination port

```
tcpdump -i eth0 src 192.168.1.10 and dst port 443
```

10. Verbose capture with full timestamps

```
tcpdump -i eth0 -vv -tttt
```

### Useful Tips

- Combine filters for more specific captures.
    
- Use `tcpdump -D` to list all available interfaces.
    
- Always run with sufficient privileges (`sudo`) to capture packets.
    
- Use `tcpdump -w` to save captures for offline analysis with Wireshark.
    
- Use `Ctrl+C` to stop capturing packets.
    
- Adjust snap length `-s` to capture full packets if needed.
    

This guide provides a comprehensive overview of the `tcpdump` command in Linux, including options, capture filters, display settings, and practical examples.

* * *

* * *

# Nmap Command in Linux

## Overview

`nmap` (Network Mapper) is a powerful and flexible command-line network scanning tool used for network discovery, security auditing, and port scanning. It can detect hosts, services, operating systems, and security vulnerabilities.

## Basic Syntax

```
nmap [Scan Type(s)] [Options] {target}
```

- `Scan Type(s)` : Specifies the type of scan (SYN scan, TCP connect scan, etc.).
    
- `Options` : Control output, speed, verbosity, or advanced features.
    
- `Target` : IP address, subnet, or hostname.
    

## Common Scan Types

- `-sS` : SYN scan (stealth scan).
    
- `-sT` : TCP connect scan.
    
- `-sU` : UDP scan.
    
- `-sN` : TCP Null scan.
    
- `-sF` : TCP FIN scan.
    
- `-sX` : Xmas scan.
    
- `-sA` : TCP ACK scan.
    
- `-sP` : Ping scan (host discovery).
    
- `-sL` : List scan (DNS enumeration).
    
- `-O` : Enable OS detection.
    
- `-sV` : Service version detection.
    
- `-Pn` : Treat all hosts as online (skip ping).
    

## Common Options

- `-p <port(s)>` : Scan specific port(s).
    
    ```
    nmap -p 22,80,443 192.168.1.10
    ```
    
- `-p-` : Scan all 65535 ports.
    
- `-T0` to `-T5` : Timing template (slow to fast).
    
- `-A` : Aggressive scan (OS detection, version, script scanning, traceroute).
    
- `-v` : Verbose mode.
    
- `-vv` : Increased verbosity.
    
- `-oN <file>` : Normal output to file.
    
- `-oX <file>` : XML output.
    
- `-oG <file>` : Grepable output.
    
- `-iL <file>` : Scan targets from file.
    
- `--top-ports <number>` : Scan the most common ports.
    
- `--open` : Show only open ports.
    
- `--reason` : Show reason for each state.
    
- `--script <script>` : Use Nmap Scripting Engine (NSE) scripts.
    

## Examples

1.  Scan a single host

```
nmap 192.168.1.10
```

2.  Scan multiple hosts

```
nmap 192.168.1.10 192.168.1.11
```

3.  Scan a subnet

```
nmap 192.168.1.0/24
```

4.  Scan specific ports

```
nmap -p 22,80,443 192.168.1.10
```

5.  Scan all ports

```
nmap -p- 192.168.1.10
```

6.  SYN scan (stealth scan)

```
nmap -sS 192.168.1.10
```

7.  TCP connect scan

```
nmap -sT 192.168.1.10
```

8.  UDP scan

```
nmap -sU 192.168.1.10
```

9.  Aggressive scan with OS and service detection

```
nmap -A 192.168.1.10
```

10. Scan with verbose output

```
nmap -v 192.168.1.10
```

11. Scan using Nmap scripts

```
nmap --script=vuln 192.168.1.10
```

12. Scan from a list of targets

```
nmap -iL targets.txt
```

13. Scan top 100 common ports only

```
nmap --top-ports 100 192.168.1.10
```

14. Show only open ports

```
nmap --open 192.168.1.10
```

## Useful Tips

- Use `sudo` for privileged scans (SYN scan, OS detection).
    
- Combine `-sV` and `-O` for detailed service and OS information.
    
- Use `-Pn` if ICMP ping is blocked by firewalls.
    
- Regularly update Nmap to get the latest NSE scripts.
    
- Use output options `-oN`, `-oX`, `-oG` to save scans for reporting.
    

This guide provides a comprehensive overview of the `nmap` command in Linux, including scan types, options, NSE scripts, and practical examples for network discovery and security auditing.

* * *

* * *

